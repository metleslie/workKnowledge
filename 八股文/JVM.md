## 1.什么是JVM
JVM就是我们常说的JAVA虚拟机，他是Java能够跨平台的基石。
程序运行之前，需要先通过编译器将Java源代码文件编译成字节码文件；
程序运行的时候，JVM会逐行对字节码进行解释，翻译成机器码指令，并交给对应的操作系统去执行。不同的版本有不同的JVM，针对操作系统。

实现一次编译处处运行的特点。

其他特性
- JVM可以自动管理内存，就是我们常说的GC回收。通过垃圾回收器将不再使用的对象回收。
- JVM包含一个即时编译器JIT，可以把热点代码翻译成机器码放到CodeCache里面，下次执行的时候不再一行一行的解释，而是直接执行缓存后的机器码，执行效率大幅度提高。
- 任何可以通过Java编译的语言，都可以在JVM运行，例如Kotlin，Groovy等

学习JVM的好处：
- 优化程序性能，避免内存问题
- 了解JVM的内存模型和垃圾回收机制，更便于我们合理分配内存，减少GC停顿
- JVM的类加载机制可以帮我们排查类加载冲突或异常
- JVM提供了很多调试工具，可以帮我们分析内存和线程的使用情况，从而解决内存溢出等问题

JVM的出现原因
跨平台可以用直译器，但是速度过慢，所以推出了JVM虚拟机，可以把字节码文件转换成机器码，转换的时候通过JIT做优化，这样的程序跑起来就快多了。

## 2.JVM的组织架构
类加载器：负责从文件系统，网络或其他来源加载Class文件，将Class文件中的二进制数据读入到内存中。
运行时数据区：JVM在执行JAVA程序时，需要在内存中分配空间来处理各种数据，这些内存区域按照Java虚拟机规范可以划分为方法区，堆，栈，虚拟机栈，程序计数器和本地方法栈。
执行引擎：JVM的心脏，负责执行字节码，包含一个**虚拟处理器**，即时编译器JIT以及垃圾回收器。

## JVM如何运行Java文件

### 编译时
当我们写了一个Java文件的时候，要让JVM运行，首先要通过JAVAC去编译，JAVAC是JDK里面的一个程序，专门用来把.java源文件编译成.class文件也就是字节码文件，在IDEA编译器里，可以使用show bytecode查看字节码文件。

我们在out文件夹里面能直接看到java格式的文件是因为IDEA用了FernFlower反编译工具将字节码文件反编译为我们看的懂的JAVA文件。

字节码包含了JVM的指令，类的元数据信息比如类名，方法和属性等

### 运行时
当我们有了字节码文件，我们就可以启动JVM来运行字节码文件，也就是到了RUN阶段，之前是build阶段。

JVM通过类加载器加载字节码文件，转换成二进制数据存储到运行时数据区，再通过执行引擎转换为机器码，最终交给操作系统执行。

我们可以使用JAVAP查看字节码的指令序列
```
0 getstatic #2 <java/lang/System.out> 3 ldc #3 <Hello World> 5 invokevirtual #4 <java/io/PrintStream.println> 8 return
```
这是一个输出helloword的指令序列
字节码指令通常包含多条指令组成，每条指令由一个操作码和若干操作数组成。
JVM就是靠这些字节码指令来完成程序执行的，常见的执行方式有两种一种是解释执行，对字节码逐条执行，一种是JIT，也就是即时编译，他会在执行热点代码时把热点代码优化并缓存起来，下次再执行时直接使用缓存的机器码执行，不需要再次解释执行，大大增加了执行效率。